#These are the SQl reports developed using Koha 23.11 version for generating various 
#visitors related reports and statistics

# Details of all visitors in between two date range and Staff who Checked-in/out

SELECT v.checkin_time 'Checked-in Time', v.checkout_time 'Checked-out Time', CONCAT(b.firstname, ' ', b.surname) 'Name', b.email 'Email', b.cardnumber 'ID Number', b.phone 'Contact Number', b.sex 'Male/Female', v.staff_checkin 'Staff Checked-in', v.staff_checkout 'Staff Checked-out'
FROM libraryvisitor.visitorsdetail v
JOIN koha_library.borrowers b ON v.borrowernumber = b.borrowernumber
WHERE DATE(v.checkin_time) BETWEEN <<Date Between (dd/mm/yyyy)|date>> AND <<and (dd/mm/yyyy)|date>> -- Replace with your desired date range
ORDER BY v.checkin_time

#  Monthly Statistics of Visitors 	

SELECT DATE_FORMAT(v.checkin_time, '%m-%Y') AS 'Month and Year', COUNT(*) AS 'Total Visitors'
FROM libraryvisitor.visitorsdetail v
WHERE DATE(v.checkin_time) BETWEEN <<Start Date (dd/mm/yyyy)|date>> AND <<End Date (dd/mm/yyyy)|date>> -- Replace with your desired date range
GROUP BY DATE_FORMAT(v.checkin_time, '%m-%Y')
ORDER BY DATE_FORMAT(v.checkin_time, '%Y-%m')

# Total Number of visitor per day in between two date range 

SELECT DATE(v.checkin_time) AS 'Date of Visit', COUNT(*) AS 'Total Visitor'
FROM libraryvisitor.visitorsdetail v
WHERE DATE(v.checkin_time) BETWEEN <<Start Date (dd/mm/yyyy)|date>> AND <<End Date (dd/mm/yyyy)|date>> -- Replace with your desired date range
GROUP BY DATE(v.checkin_time)
ORDER BY DATE(v.checkin_time)


# Details of all visitors who have not yet checked out from Library

SELECT v.checkin_time AS 'Checked-in Time', v.checkout_time AS 'Checked-out Time', CONCAT(b.firstname, ' ', b.surname) AS 'Name',
    b.email AS 'Email', b.cardnumber AS 'ID Number', b.phone AS 'Contact Number', b.sex AS 'Male/Female'
FROM libraryvisitor.visitorsdetail v
JOIN koha_library.borrowers b ON v.borrowernumber = b.borrowernumber
WHERE v.checkout_time IS NULL
ORDER BY v.checkin_time